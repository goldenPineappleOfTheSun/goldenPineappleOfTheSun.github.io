<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Scale Keyboard</title>

	<style>
		body {
			font-family: sans-serif;
			text-align: center;
			padding: 20px;
		}

		select {
			font-size: 16px;
			padding: 6px;
			margin-bottom: 20px;
		}

		.grid {
			display: grid;
			grid-template-columns: 90px repeat(7, 1fr);
			gap: 6px;
			max-width: 700px;
			margin: 0 auto;
		}

		.row-title {
			display: flex;
			align-items: center;
			justify-content: flex-end;
			font-size: 12px;
			padding-right: 6px;
			opacity: 0.7;
		}

		.button {
			border: 1px solid #333;
			background: #f2f2f2;
			font-size: 14px;
			height: 48px;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			user-select: none;
		}

		.button.small {
			height: 26px;
			font-size: 11px;
			opacity: 0.6;
		}

		.button:active {
			background: #ddd;
		}

		.major {
			background: white;
		}

		.minor {
			background: white;
		}

		.seventh {
			outline: 1px solid #F4B342;
			background: white;
		}

		.seventh-minor {
			outline: 1px solid #360185;
			background: white;
		}

		.sus-4 {
			outline: 1px solid #41A67E;
			background: white;
		}

		.sus-2 {
			outline: 1px solid #6DC3BB;
			background: white;
		}

		.dim {
			outline: 1px solid #DE1A58;
			background: white;
		}

		.aug {
			outline: 1px solid #8F0177;
			background: white;
		}
	</style>
	</style>
</head>
<body>

	<h2>Scale selector</h2>

	<select id="scaleSelect"></select>

	<div class="grid" id="buttonGrid"></div>

	<script>
		// ---------- sound ----------

		let audioContext = null
		let activeOscillators = []

		const noteFrequencies = {
			'c': 261.63,'c#': 277.18,'d': 293.66,'d#': 311.13,
			'e': 329.63,'f': 349.23,'f#': 369.99,'g': 392.00,
			'g#': 415.30,'a': 440.00,'a#': 466.16,'b': 493.88
		}

		function ensureAudioContext() {
			if (!audioContext) {
				audioContext = new (window.AudioContext || window.webkitAudioContext)()
			}
			if (audioContext.state === 'suspended') {
				audioContext.resume()
			}
		}

		function playMusicNotes(notes) {
			ensureAudioContext()
			stopNotes()

			notes.forEach(note => {
				const freq = noteFrequencies[note]
				if (!freq) return

				const osc = audioContext.createOscillator()
				const gain = audioContext.createGain()

				osc.type = 'sine'
				osc.frequency.value = freq
				gain.gain.value = 0.15

				osc.connect(gain)
				gain.connect(audioContext.destination)

				osc.start()
				activeOscillators.push(osc)
			})
		}

		function stopNotes() {
			activeOscillators.forEach(o => { try { o.stop() } catch {} })
			activeOscillators = []
		}

		window.addEventListener('touchstart', ensureAudioContext, { once: true })
		window.addEventListener('load', () => playMusicNotes(['c','e','g','b']))

		// ---------- harmony ----------

		const notes = ['c','c#','d','d#','e','f','f#','g','g#','a','a#','b']

		const scaleIntervals = {
			major: [0,2,4,5,7,9,11],
			minor: [0,2,3,5,7,8,10]
		}

		const chordFormulas = {
			maj:[0,4,7], min:[0,3,7],
			maj7:[0,4,7,11], min7:[0,3,7,10],
			sus4:[0,5,7], sus2:[0,2,7],
			'7sus4':[0,5,7,10], '7sus2':[0,2,7,10],
			dim:[0,3,6], aug:[0,4,8],
			power:[0,7]
		}

		function playChord(step, type) {
			const isMinor = scaleSelect.value.includes('Minor')
			const scaleType = isMinor ? 'minor' : 'major'

			const rootName = scaleSelect.value.split(' ')[0]
			const rootIndex = notes.indexOf(rootName.toLowerCase())
			if (rootIndex < 0) return

			const degree = (step - 1) % 7
			const octave = Math.floor((step - 1) / 7) * 12

			const rootSemitone =
				rootIndex +
				scaleIntervals[scaleType][degree] +
				octave

			const chordNotes = chordFormulas[type].map(i =>
				notes[(rootSemitone + i) % 12]
			)

			playMusicNotes(chordNotes)
		}

		// ---------- UI ----------

		const scaleSelect = document.getElementById('scaleSelect')
		const buttonGrid = document.getElementById('buttonGrid')

		;['C','C#','D','D#','E','F','F#','G','G#','A','A#','B']
			.forEach(n => {
				scaleSelect.add(new Option(n+' Major', n+' Major'))
				scaleSelect.add(new Option(n+' Minor', n+' Minor'))
			})

		const majorRoman = ['I','ii','iii','IV','V','vi','vii°']
		const minorRoman = ['i','ii°','III','iv','v','VI','VII']

		const rows = [
			{label:'maj#', type:'maj', raised:true},
			{label:'maj',  type:'maj'},
			{label:'min#', type:'min', raised:true},
			{label:'min',  type:'min'},
			{label:'7#',   type:'maj7', raised:true},
			{label:'7',    type:'maj7'},
			{label:'m7#',  type:'min7', raised:true},
			{label:'m7',   type:'min7'},
			{label:'sus4#',type:'sus4', raised:true},
			{label:'sus4', type:'sus4'},
			{label:'sus2#',type:'sus2', raised:true},
			{label:'sus2', type:'sus2'},
			{label:'dim#', type:'dim', raised:true},
			{label:'dim',  type:'dim'},
			{label:'aug#', type:'aug', raised:true},
			{label:'aug',  type:'aug'}
		]

		const styles = {
			'maj': 'major',
			'min': 'minor',
			'maj7': 'seventh',
			'min7': 'seventh-minor',
			'sus4': 'sus-4',
			'sus2': 'sus-2',
			'dim': 'dim',
			'aug': 'aug',
		}

		function renderGrid() {
			buttonGrid.innerHTML = ''
			const romans = scaleSelect.value.includes('Minor') ? minorRoman : majorRoman

			rows.forEach(row => {
				const title = document.createElement('div')
				title.className = 'row-title'
				title.textContent = row.label
				buttonGrid.appendChild(title)

				romans.forEach((r, i) => {
					const b = document.createElement('div')
					b.className = 'button' + (row.raised ? ' small' : '')
					b.textContent = row.raised ? r+'#' : r
					b.onclick = () => playChord(i+1, row.type)
					b.classList.add(styles[row.type])
					buttonGrid.appendChild(b)
				})
			})
		}

		scaleSelect.onchange = renderGrid
		renderGrid()
	</script>

</body>
</html>
